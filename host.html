<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Darkz Mafia - Host</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; padding: 20px; text-align: center; }
    input, button { padding: 10px; margin: 10px; border-radius: 8px; border: none; font-size: 16px; }
    button { background: #444; color: #fff; cursor: pointer; }
    button:hover { background: #666; }
    .player-list { margin-top: 20px; }
    .player-item { margin: 5px 0; padding: 5px; background: #222; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>üïπÔ∏è Darkz Mafia - Host</h1>
  <input type="text" id="hostSession" placeholder="Enter Session ID">
  <button onclick="startHost()">Start Session</button>
  <div id="sessionDisplay"></div>

  <h2>Players</h2>
  <div class="player-list" id="playerList"></div>

  <button onclick="assignRoles()">üé≤ Assign Roles</button>
  <button onclick="endGame()" style="margin-left: 10px; background: darkred;">‚ùå End Game</button>
  <div class="message" id="gameStatus" style="margin-top: 20px;"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB2dpdsTkKtNHsxFkN6wmvJkLL9lhmWPBE",
      authDomain: "mafia-darkz-995bb.firebaseapp.com",
      databaseURL: "https://mafia-darkz-995bb-default-rtdb.firebaseio.com",
      projectId: "mafia-darkz-995bb",
      storageBucket: "mafia-darkz-995bb.appspot.com",
      messagingSenderId: "555156171160",
      appId: "1:555156171160:web:9e5cd8ab8eb9ba7661423ed"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function startHost() {
      const sessionId = document.getElementById('hostSession').value.trim();
      if (!sessionId) return alert('Enter session ID');
      localStorage.setItem('hostSessionId', sessionId);
      document.getElementById('sessionDisplay').textContent = `Session: ${sessionId}`;
      loadPlayers(sessionId);
    }

    function loadPlayers(sessionId) {
      const ref = db.ref(`players/${sessionId}`);
      ref.on('child_added', (snap) => {
        const playerData = snap.val();
        const playerDiv = document.createElement('div');
        playerDiv.className = 'player-item';
        playerDiv.textContent = playerData.name;
        document.getElementById('playerList').appendChild(playerDiv);
      });
    }

    function assignRoles() {
      const sessionId = localStorage.getItem('hostSessionId');
      if (!sessionId) return;
      const roles = ['ü¶π Mafia', 'üßë‚Äç‚öïÔ∏è Doctor', 'üßì Elder'];
      const ref = db.ref(`players/${sessionId}`);
      ref.once('value', (snapshot) => {
        const players = [];
        snapshot.forEach((child) => {
          players.push(child.val().name);
        });
        const shuffled = players.sort(() => 0.5 - Math.random());
        const assigned = {};
        shuffled.forEach((name, i) => {
          const role = roles[i] || 'üë§ Villager';
          assigned[name] = role;
        });
        for (const name in assigned) {
          db.ref(`sessions/${sessionId}/${name}`).set(assigned[name]);
        }
        document.getElementById('gameStatus').textContent = '‚úÖ Roles assigned!';
      });
    }

    function endGame() {
      const sessionId = localStorage.getItem('hostSessionId');
      if (!sessionId) return;
      db.ref(`players/${sessionId}`).remove();
      db.ref(`sessions/${sessionId}`).remove();
      document.getElementById('playerList').innerHTML = '';
      document.getElementById('gameStatus').textContent = '‚ùå Game ended and data cleared';
    }

    window.onload = () => {
      const saved = localStorage.getItem('hostSessionId');
      if (saved) {
        document.getElementById('hostSession').value = saved;
        startHost();
      }
    };
  </script>
</body>
</html>
