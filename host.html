
<!DOCTYPE html>

<html lang="ar">
<head>
<meta charset="utf-8"/>
<title>Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø§ÙÙŠØ§</title>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;600&amp;display=swap" rel="stylesheet"/>
<style>
    body {
      font-family: 'IBM Plex Sans Arabic', sans-serif;
      background-color: #0f172a;
      color: white;
      text-align: center;
      padding: 30px;
    }
    input, select, button {
      padding: 10px;
      margin: 8px;
      border-radius: 8px;
      border: none;
      font-size: 1em;
    }
    .players-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-top: 30px;
    }
    .player-card {
      background-color: #1e293b;
      padding: 15px;
      border-radius: 10px;
      width: 200px;
      text-align: right;
    }
    .player-card p {
      margin: 5px 0;
    }
    .danger {
      background-color: #dc2626;
      color: white;
    }
    .danger:hover {
      background-color: #ef4444;
    }
    .admin-button {
      margin-top: 30px;
      background-color: #991b1b;
    }
  </style>
</head>
<body><select id="gameStatus" style="margin-top:20px; padding:10px; font-size:1em;"><option value="waiting">â³ ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option><option value="mafia_time">ğŸ˜ˆ ÙˆÙ‚Øª Ø§Ù„Ù…Ø§ÙÙŠØ§</option><option value="doctor_time">ğŸ©º ÙˆÙ‚Øª Ø§Ù„Ø¯ÙƒØªÙˆØ±</option><option value="shai5_time">ğŸ‘ï¸ ÙˆÙ‚Øª Ø§Ù„Ø´Ø§ÙŠØ¨</option><option value="voting">ğŸ—³ï¸ ÙˆÙ‚Øª Ø§Ù„ØªØµÙˆÙŠØª</option><option value="ended">ğŸ›‘ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬ÙˆÙ„Ø©</option><option value="result">ğŸ† Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©</option><option value="reset">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¬ÙˆÙ„Ø©</option></select>
<h1>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø§ÙÙŠØ§</h1>
<div id="sessionBox">
<input id="sessionIdInput" placeholder="Ø±Ù…Ø² Ø§Ù„Ø¬Ù„Ø³Ø©" type="text"/>
<button onclick="confirmSession()">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
</div>
<div id="controls" style="display:none;">
<p><strong>Ø±Ù…Ø² Ø§Ù„Ø¬Ù„Ø³Ø©:</strong> <span id="sessionDisplay"></span></p>
<label>ğŸ® Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©:</label>
<select id="gameStatus" onchange="updateStatus()">
<option value="waiting">ğŸ”„ Ø§Ù†ØªØ¸Ø§Ø±</option>
<option value="playing">ğŸ­ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</option>
<option value="voting">ğŸ—³ï¸ ØªØµÙˆÙŠØª</option>
<option value="ended">ğŸ’€ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØµÙˆÙŠØª</option>
<option value="result">ğŸ† Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ÙØ§Ø¦Ø²</option>
<option value="reset">ğŸ” Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</option>
</select>
<br/>
<label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø§ÙÙŠØ§:</label>
<select id="mafiaCount">
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
</select>
<button onclick="assignRoles()">ğŸ­ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</button>
<button onclick="loadPlayers()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</button>
<button class="danger" onclick="deleteSession()">ğŸ›‘ Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø©</button>
</div>
<div class="players-container" id="playersList"></div>
<div id="winner" style="font-size:1.4em; margin-top: 30px;"></div>
<div>
<button class="admin-button" onclick="goToAdmin()">âš™ï¸ ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</button>
</div>
<script>
    const firebaseConfig = {
      apiKey: "AIzaSyCTmpMEJdgbcwXs1Te5C4qvwtXSK526fWk",
      authDomain: "sama-form.firebaseapp.com",
      databaseURL: "https://sama-form-default-rtdb.firebaseio.com",
      projectId: "sama-form",
      storageBucket: "sama-form.appspot.com",
      messagingSenderId: "978448315706",
      appId: "1:978448315706:web:84a0792d0ee4a91eb08c03"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let sessionId = "";

    function confirmSession() {
      const input = document.getElementById("sessionIdInput").value.trim();
      if (!input) return alert("Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¬Ù„Ø³Ø©");
      sessionId = input;
      document.getElementById("sessionBox").style.display = "none";
      document.getElementById("controls").style.display = "block";
      document.getElementById("sessionDisplay").innerText = sessionId;
      loadPlayers();
    }

    function loadPlayers() {
      const list = document.getElementById("playersList");
      db.ref(`sessions/${sessionId}/players`).once("value", snap => {
        const players = snap.val();
        list.innerHTML = "";
        for (const key in players) {
          const p = players[key];
          const card = document.createElement("div");
          card.className = "player-card";
          card.innerHTML = `
            <p><strong>${p.name}</strong></p>
            <p>Ø§Ù„Ø­Ø§Ù„Ø©: ${p.alive ? "âœ… Ø­ÙŠ" : "â˜ ï¸ Ù…ÙŠØª"}</p>
            <p>Ø§Ù„Ø¯ÙˆØ±: ${p.role || "?"}</p>
            <button class="danger" onclick="killPlayer('${key}')">Ù‚ØªÙ„</button>
          `;
          list.appendChild(card);
        }
      });
    }

    function assignRoles() {
      db.ref(`sessions/${sessionId}/players`).once("value", snap => {
        const players = snap.val();
        const keys = Object.keys(players);
        const mafiaCount = parseInt(document.getElementById("mafiaCount").value);
        const roles = Array(mafiaCount).fill("mafia").concat(["doctor", "shai5"]);
        const shuffled = keys.sort(() => 0.5 - Math.random());
        shuffled.forEach((key, index) => {
          const role = index < roles.length ? roles[index] : "citizen";
          db.ref(`sessions/${sessionId}/players/${key}/role`).set(role);
        });
        loadPlayers();
      });
    }

    function updateStatus() {
      const status = document.getElementById("gameStatus").value;
      db.ref(`sessions/${sessionId}/gameStatus`).set(status);
      if (status === "result") {
        calculateWinner();
      } else {
        document.getElementById("winner").innerText = "";
      }
    }

    function calculateWinner() {
      db.ref(`sessions/${sessionId}/players`).once("value", snap => {
        const players = snap.val();
        let mafiaAlive = 0;
        let othersAlive = 0;
        for (const key in players) {
          const p = players[key];
          if (!p.alive) continue;
          if (p.role === "mafia") mafiaAlive++;
          else othersAlive++;
        }
        let result = "ğŸ¤” Ù„Ù… ØªÙ†ØªÙ‡Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¹Ø¯.";
        if (mafiaAlive === 0) result = "âœ… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙØ§Ø¦Ø²: Ø§Ù„Ø·ÙŠØ¨ÙŠÙ†!";
        else if (mafiaAlive >= othersAlive) result = "ğŸ˜ˆ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙØ§Ø¦Ø²: Ø§Ù„Ù…Ø§ÙÙŠØ§!";
        document.getElementById("winner").innerText = result;
      });
    }

    function killPlayer(id) {
      db.ref(`sessions/${sessionId}/players/${id}/alive`).set(false);
      loadPlayers();
    }

    function deleteSession() {
      if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ")) {
        db.ref(`sessions/${sessionId}`).remove();
        location.reload();
      }
    }

    function goToAdmin() {
      const pass = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
      if (pass === "darkz2025") {
        window.location.href = "admin.html";
      } else {
        alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
      }
    }
  </script>
<script>
function translateRole(role) {
  switch(role) {
    case "mafia": return "ğŸ˜ˆ Ø§Ù„Ù…Ø§ÙÙŠØ§";
    case "doctor": return "ğŸ©º Ø§Ù„Ø¯ÙƒØªÙˆØ±";
    case "shai5": return "ğŸ‘ï¸ Ø§Ù„Ø´Ø§ÙŠØ¨";
    case "citizen": return "ğŸ‘¤ Ø§Ù„Ù…ÙˆØ§Ø·Ù†";
    default: return "ØŸ";
  }
}

function countVotes(players) {
  const voteCount = {};
  for (const key in players) {
    const vote = players[key].vote;
    if (vote) {
      voteCount[vote] = (voteCount[vote] || 0) + 1;
    }
  }
  return voteCount;
}

function loadPlayers() {
  const list = document.getElementById("playersList");
  db.ref(`sessions/${sessionId}/players`).once("value", snap => {
    const players = snap.val();
    const voteCounts = countVotes(players);
    list.innerHTML = "";
    for (const key in players) {
      const p = players[key];
      const card = document.createElement("div");
      card.className = "player-card";
      card.innerHTML = `
        <p><strong>${p.name}</strong></p>
        <p>Ø§Ù„Ø­Ø§Ù„Ø©: ${p.alive ? "ğŸŸ¢ Ø­ÙŠ" : "ğŸ”´ Ù…ÙŠØª"}</p>
        <p>Ø§Ù„Ø¯ÙˆØ±: ${translateRole(p.role)}</p>
        <p>ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„ØªØµÙˆÙŠØªØ§Øª: ${voteCounts[key] || 0}</p>
        <button onclick="killPlayer('${key}')">ğŸ’€ Ù‚ØªÙ„</button>
      `;
      list.appendChild(card);
    }
  });
}
</script><script>
function autoKillHighestVoted() {
  db.ref(`sessions/${sessionId}/players`).once("value", snap => {
    const players = snap.val();
    const voteCounts = countVotes(players);
    let maxVotes = 0;
    let topVoted = null;

    for (const id in voteCounts) {
      if (voteCounts[id] > maxVotes) {
        maxVotes = voteCounts[id];
        topVoted = id;
      }
    }

    if (topVoted) {
      db.ref(`sessions/${sessionId}/players/${topVoted}/alive`).set(false);
    }
  });
}

// ØªØ¹Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù† select
document.addEventListener("DOMContentLoaded", function () {
  const selector = document.getElementById("gameStatus");
  if (selector) {
    selector.addEventListener("change", function () {
      const status = selector.value;
      db.ref(`sessions/${sessionId}/gameStatus`).set(status);
      if (status === "ended") {
        autoKillHighestVoted();
      }
    });
  }
});
</script><div id="gameResultDisplay" style="margin-top:20px;font-size:1.2em;font-weight:bold;"></div><script>
function displayWinner() {
  db.ref(`sessions/${sessionId}/players`).once("value", snap => {
    const players = snap.val();
    let mafiaAlive = 0;
    let othersAlive = 0;
    for (const key in players) {
      const p = players[key];
      if (!p.alive) continue;
      if (p.role === "mafia") mafiaAlive++;
      else othersAlive++;
    }
    const resultText = mafiaAlive === 0
      ? "âœ… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙØ§Ø¦Ø²: Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø·ÙŠØ¨ÙŠÙ†"
      : (mafiaAlive >= othersAlive ? "ğŸ˜ˆ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙØ§Ø¦Ø²: Ø§Ù„Ù…Ø§ÙÙŠØ§" : "ğŸ¤” Ù„Ù… ØªÙ†ØªÙ‡Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¹Ø¯");
    document.getElementById("gameResultDisplay").innerText = resultText;
  });
}

document.addEventListener("DOMContentLoaded", function () {
  const selector = document.getElementById("gameStatus");
  if (selector) {
    selector.addEventListener("change", function () {
      const status = selector.value;
      db.ref(`sessions/${sessionId}/gameStatus`).set(status);
      if (status === "result") {
        displayWinner();
      }
    });
  }
});
</script><script>
function resetGame() {
  db.ref(`sessions/${sessionId}/players`).once("value", snap => {
    const players = snap.val();
    for (const key in players) {
      db.ref(`sessions/${sessionId}/players/${key}`).update({
        alive: true,
        vote: null
      });
    }
  });
}

document.addEventListener("DOMContentLoaded", function () {
  const selector = document.getElementById("gameStatus");
  if (selector) {
    selector.addEventListener("change", function () {
      const status = selector.value;
      db.ref(`sessions/${sessionId}/gameStatus`).set(status);
      if (status === "reset") {
        resetGame();
      }
    });
  }
});
</script><script>
document.addEventListener("DOMContentLoaded", function () {
  const selector = document.getElementById("gameStatus");
  if (selector) {
    selector.addEventListener("change", function () {
      const status = selector.value;
      db.ref(`sessions/${sessionId}/gameStatus`).set(status);
    });
  }
});
</script></body>
</html>
